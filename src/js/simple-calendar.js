(function() {
    'use strict';

    // „Éï„Ç£„Éº„É´„Éâ„Ç≥„Éº„Éâ
    const FIELDS = {
        TASK_NAME: 'task_name',
        PROJECT_NAME: 'project_name', 
        START_DATE: 'start_date',
        END_DATE: 'end_date',
        TASK_TYPE: 'task_type',
        STATUS: 'status',
        DESCRIPTION: 'description',
        PRIORITY: 'priority'
    };

    let calendar;
    let allTasks = [];

    // „Éì„É•„ÉºË°®Á§∫ÊôÇ„ÅÆÂá¶ÁêÜ
    kintone.events.on('app.record.index.show', function(event) {
        // „Äå„Ç´„É¨„É≥„ÉÄ„ÉºË°®Á§∫„Äç„Éì„É•„Éº„Åß„ÅÆ„ÅøÂÆüË°å
        if (event.viewName !== '„Ç´„É¨„É≥„ÉÄ„ÉºË°®Á§∫') {
            return event;
        }

        console.log('„Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„Éº„ÅåÈñã„Åã„Çå„Åæ„Åó„Åü');
        
        // Â∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶„Åã„ÇâÂàùÊúüÂåñ
        setTimeout(function() {
            initCalendar();
        }, 500);
        
        return event;
    });

    function initCalendar() {
        console.log('„Ç´„É¨„É≥„ÉÄ„ÉºÂàùÊúüÂåñÈñãÂßã');
        
        // „Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ„Å´„Ç´„É¨„É≥„ÉÄ„Éº„ÇíÊåøÂÖ•
        const headerSpace = kintone.app.getHeaderSpaceElement();
        if (!headerSpace) {
            console.error('„Éò„ÉÉ„ÉÄ„Éº„Çπ„Éö„Éº„Çπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
            return;
        }

        // HTML„ÇíÊåøÂÖ•
        headerSpace.innerHTML = `
            <div id="calendar-app">
                <div class="calendar-header">
                    <h2>üìÖ „Çø„Çπ„ÇØ„Ç´„É¨„É≥„ÉÄ„Éº</h2>
                    <button id="add-task-btn" class="add-btn">+ „Çø„Çπ„ÇØËøΩÂä†</button>
                </div>
                <div class="calendar-controls">
                    <select id="project-filter">
                        <option value="">ÂÖ®Ê°à‰ª∂</option>
                    </select>
                    <button id="refresh-btn" class="refresh-btn">üîÑ Êõ¥Êñ∞</button>
                </div>
                <div id="calendar-container"></div>
            </div>
        `;

        // „Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
        addStyles();
        
        // FullCalendar„É©„Ç§„Éñ„É©„É™„ÇíË™≠„ÅøËæº„Åø
        loadFullCalendar().then(function() {
            createCalendar();
            loadTasks();
        });
    }

    function addStyles() {
        const style = document.createElement('style');
        style.textContent = `
            #calendar-app {
                margin: 20px 0;
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            
            .calendar-header {
                background: #4CAF50;
                color: white;
                padding: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .calendar-header h2 {
                margin: 0;
                font-size: 24px;
            }
            
            .add-btn {
                background: #fff;
                color: #4CAF50;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                font-weight: bold;
            }
            
            .add-btn:hover {
                background: #f0f0f0;
            }
            
            .calendar-controls {
                padding: 15px 20px;
                background: #f5f5f5;
                display: flex;
                gap: 15px;
                align-items: center;
            }
            
            .calendar-controls select {
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background: white;
            }
            
            .refresh-btn {
                background: #2196F3;
                color: white;
                border: none;
                padding: 8px 15px;
                border-radius: 4px;
                cursor: pointer;
            }
            
            .refresh-btn:hover {
                background: #1976D2;
            }
            
            #calendar-container {
                padding: 20px;
                min-height: 500px;
            }
            
            .fc-event.completed {
                opacity: 0.6;
                text-decoration: line-through;
            }
            
            .fc-event.completed::before {
                content: "‚úÖ ";
                font-size: 12px;
            }
            
            .fc-event.high-priority {
                border-left: 4px solid #ff4444;
                font-weight: bold;
            }
            
            .fc-event.daily-task {
                border-style: dashed;
            }
            
            .fc-event.daily-task::after {
                content: "üîÑ";
                position: absolute;
                top: 2px;
                right: 4px;
                font-size: 10px;
            }
            
            .task-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            }
            
            .modal-content {
                background: white;
                border-radius: 8px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            }
            
            .modal-header {
                padding: 20px;
                border-bottom: 1px solid #eee;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .modal-header h3 {
                margin: 0;
                color: #333;
            }
            
            .close-btn {
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: #666;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                color: #333;
            }
            
            .form-group input,
            .form-group select,
            .form-group textarea {
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
                box-sizing: border-box;
            }
            
            .form-group textarea {
                height: 80px;
                resize: vertical;
            }
            
            .modal-footer {
                padding: 20px;
                border-top: 1px solid #eee;
                display: flex;
                justify-content: flex-end;
                gap: 10px;
            }
            
            .btn {
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }
            
            .btn-primary {
                background: #4CAF50;
                color: white;
            }
            
            .btn-primary:hover {
                background: #45a049;
            }
            
            .btn-secondary {
                background: #6c757d;
                color: white;
            }
            
            .btn-secondary:hover {
                background: #545b62;
            }
            
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 4px;
                color: white;
                font-weight: bold;
                z-index: 10001;
            }
            
            .notification.success {
                background: #4CAF50;
            }
            
            .notification.error {
                background: #f44336;
            }
        `;
        document.head.appendChild(style);
    }

    function loadFullCalendar() {
        return new Promise(function(resolve) {
            if (window.FullCalendar) {
                console.log('FullCalendar already loaded');
                resolve();
                return;
            }

            console.log('Loading FullCalendar...');
            
            // CSS
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css';
            document.head.appendChild(link);

            // JavaScript
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js';
            script.onload = function() {
                console.log('FullCalendar loaded successfully');
                resolve();
            };
            script.onerror = function() {
                console.error('FullCalendar loading failed');
                resolve();
            };
            document.head.appendChild(script);
        });
    }

    function createCalendar() {
        console.log('Creating calendar...');
        
        const calendarEl = document.getElementById('calendar-container');
        if (!calendarEl) {
            console.error('Calendar container not found');
            return;
        }

        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ja',
            height: 600,
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            editable: true,
            selectable: true,
            dateClick: function(info) {
                console.log('Date clicked:', info.dateStr);
                openTaskModal(info.date);
            },
            eventClick: function(info) {
                console.log('Event clicked:', info.event.title);
                openTaskEditModal(info.event);
            },
            eventDrop: function(info) {
                console.log('Event dropped');
                updateTaskDate(info.event, info.event.start);
            },
            eventDidMount: function(info) {
                // ÂÆå‰∫Ü„Çø„Çπ„ÇØ„Å´„ÉÅ„Çß„ÉÉ„ÇØ„Éû„Éº„ÇØ
                if (info.event.extendedProps.status === 'ÂÆå‰∫Ü') {
                    info.el.classList.add('completed');
                }
                
                // È´òÂÑ™ÂÖàÂ∫¶
                if (info.event.extendedProps.priority === 'È´ò') {
                    info.el.classList.add('high-priority');
                }
                
                // „Éá„Ç§„É™„Éº„Çø„Çπ„ÇØ
                if (info.event.extendedProps.task_type === '„Éá„Ç§„É™„Éº') {
                    info.el.classList.add('daily-task');
                }
            }
        });

        calendar.render();
        console.log('Calendar rendered');
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        setupEventListeners();
    }

    function setupEventListeners() {
        // „Çø„Çπ„ÇØËøΩÂä†„Éú„Çø„É≥
        document.getElementById('add-task-btn').addEventListener('click', function() {
            openTaskModal(new Date());
        });
        
        // Êõ¥Êñ∞„Éú„Çø„É≥
        document.getElementById('refresh-btn').addEventListener('click', function() {
            loadTasks();
        });
        
        // „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éï„Ç£„É´„Çø„Éº
        document.getElementById('project-filter').addEventListener('change', function() {
            filterTasks();
        });
    }

    function loadTasks() {
        console.log('Loading tasks...');
        
        kintone.api('/k/v1/records', 'GET', {
            app: kintone.app.getId(),
            query: `${FIELDS.START_DATE} != "" order by ${FIELDS.START_DATE} asc`
        }).then(function(response) {
            console.log('Tasks loaded:', response.records.length);
            allTasks = response.records;
            updateProjectFilter();
            displayTasks();
        }).catch(function(error) {
            console.error('Task loading error:', error);
            showNotification('„Çø„Çπ„ÇØ„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
        });
    }

    function updateProjectFilter() {
        const select = document.getElementById('project-filter');
        const projects = [...new Set(allTasks.map(task => task[FIELDS.PROJECT_NAME].value))];
        
        // Êó¢Â≠ò„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„Çí„ÇØ„É™„Ç¢ÔºàÊúÄÂàù„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥‰ª•Â§ñÔºâ
        select.innerHTML = '<option value="">ÂÖ®Ê°à‰ª∂</option>';
        
        projects.forEach(function(project) {
            if (project) {
                const option = document.createElement('option');
                option.value = project;
                option.textContent = project;
                select.appendChild(option);
            }
        });
    }

    function displayTasks() {
        if (!calendar) return;
        
        calendar.removeAllEvents();
        
        const filteredTasks = getFilteredTasks();
        const events = filteredTasks.map(function(task) {
            return {
                id: task.$id.value,
                title: task[FIELDS.TASK_NAME].value,
                start: task[FIELDS.START_DATE].value,
                end: task[FIELDS.END_DATE].value || null,
                backgroundColor: getProjectColor(task[FIELDS.PROJECT_NAME].value),
                extendedProps: {
                    project_name: task[FIELDS.PROJECT_NAME].value,
                    task_type: task[FIELDS.TASK_TYPE].value,
                    status: task[FIELDS.STATUS].value,
                    priority: task[FIELDS.PRIORITY].value,
                    description: task[FIELDS.DESCRIPTION].value,
                    record_id: task.$id.value
                }
            };
        });
        
        calendar.addEventSource(events);
    }

    function getFilteredTasks() {
        const projectFilter = document.getElementById('project-filter').value;
        
        return allTasks.filter(function(task) {
            if (projectFilter && task[FIELDS.PROJECT_NAME].value !== projectFilter) {
                return false;
            }
            return true;
        });
    }

    function getProjectColor(projectName) {
        const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3', '#54A0FF'];
        const hash = projectName.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
        return colors[hash % colors.length];
    }

    function openTaskModal(date, existingTask = null) {
        console.log('Opening task modal for date:', date);
        
        const isEdit = !!existingTask;
        const title = isEdit ? '„Çø„Çπ„ÇØÁ∑®ÈõÜ' : 'Êñ∞Ë¶è„Çø„Çπ„ÇØ‰ΩúÊàê';
        
        const modal = document.createElement('div');
        modal.className = 'task-modal';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3>${title}</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="task-form">
                        <div class="form-group">
                            <label>„Çø„Çπ„ÇØÂêç *</label>
                            <input type="text" id="task-name" required 
                                   value="${isEdit ? existingTask.title : ''}" 
                                   placeholder="‰æã: Ë≥áÊñô‰ΩúÊàê">
                        </div>
                        
                        <div class="form-group">
                            <label>Ê°à‰ª∂Âêç *</label>
                            <select id="project-name" required>
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>‰ΩúÊ•≠ÂÜÖÂÆπ</label>
                            <textarea id="task-description" 
                                      placeholder="‰ΩúÊ•≠„ÅÆË©≥Á¥∞„ÇíÂÖ•Âäõ...">${isEdit ? (existingTask.extendedProps.description || '') : ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>ÈñãÂßãÊó•ÊôÇ *</label>
                            <input type="datetime-local" id="start-date" required
                                   value="${formatDateForInput(isEdit ? existingTask.start : date)}">
                        </div>
                        
                        <div class="form-group">
                            <label>ÁµÇ‰∫ÜÊó•ÊôÇ</label>
                            <input type="datetime-local" id="end-date"
                                   value="${isEdit && existingTask.end ? formatDateForInput(existingTask.end) : ''}">
                        </div>
                        
                        <div class="form-group">
                            <label>„Çø„Çπ„ÇØÁ®ÆÂà• *</label>
                            <select id="task-type" required>
                                <option value="ÂçòÁô∫" ${isEdit && existingTask.extendedProps.task_type === 'ÂçòÁô∫' ? 'selected' : ''}>ÂçòÁô∫</option>
                                <option value="„Éá„Ç§„É™„Éº" ${isEdit && existingTask.extendedProps.task_type === '„Éá„Ç§„É™„Éº' ? 'selected' : ''}>„Éá„Ç§„É™„Éº</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>„Çπ„ÉÜ„Éº„Çø„Çπ *</label>
                            <select id="status" required>
                                <option value="Êú™ÁùÄÊâã" ${isEdit && existingTask.extendedProps.status === 'Êú™ÁùÄÊâã' ? 'selected' : ''}>Êú™ÁùÄÊâã</option>
                                <option value="ÈÄ≤Ë°å‰∏≠" ${isEdit && existingTask.extendedProps.status === 'ÈÄ≤Ë°å‰∏≠' ? 'selected' : ''}>ÈÄ≤Ë°å‰∏≠</option>
                                <option value="ÂÆå‰∫Ü" ${isEdit && existingTask.extendedProps.status === 'ÂÆå‰∫Ü' ? 'selected' : ''}>ÂÆå‰∫Ü</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>ÂÑ™ÂÖàÂ∫¶</label>
                            <select id="priority">
                                <option value="‰Ωé" ${isEdit && existingTask.extendedProps.priority === '‰Ωé' ? 'selected' : ''}>‰Ωé</option>
                                <option value="‰∏≠" ${isEdit && existingTask.extendedProps.priority === '‰∏≠' ? 'selected' : 'selected'}>‰∏≠</option>
                                <option value="È´ò" ${isEdit && existingTask.extendedProps.priority === 'È´ò' ? 'selected' : ''}>È´ò</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">„Ç≠„É£„É≥„Çª„É´</button>
                    <button type="submit" form="task-form" class="btn btn-primary">${isEdit ? 'Êõ¥Êñ∞' : '‰ΩúÊàê'}</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Ç™„Éó„Ç∑„Éß„É≥„ÇíË™≠„ÅøËæº„Åø
        loadProjectOptions(isEdit ? existingTask.extendedProps.project_name : null);
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        modal.querySelector('.close-btn').addEventListener('click', function() {
            closeModal();
        });
        
        modal.querySelector('#task-form').addEventListener('submit', function(e) {
            e.preventDefault();
            if (isEdit) {
                updateTask(existingTask.extendedProps.record_id);
            } else {
                createTask();
            }
        });
        
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });
        
        // „Éï„Ç©„Éº„Ç´„Çπ
        setTimeout(function() {
            modal.querySelector('#task-name').focus();
        }, 100);
    }

    function openTaskEditModal(event) {
        openTaskModal(event.start, event);
    }

    function loadProjectOptions(selectedProject = null) {
        const select = document.getElementById('project-name');
        const projects = [...new Set(allTasks.map(task => task[FIELDS.PROJECT_NAME].value))];
        
        // Êó¢Â≠ò„ÅÆ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÇíËøΩÂä†
        projects.forEach(function(project) {
            if (project) {
                const option = document.createElement('option');
                option.value = project;
                option.textContent = project;
                if (project === selectedProject) {
                    option.selected = true;
                }
                select.appendChild(option);
            }
        });
        
        // Êñ∞Ë¶è„Éó„É≠„Ç∏„Çß„ÇØ„ÉàËøΩÂä†„Ç™„Éó„Ç∑„Éß„É≥
        const newOption = document.createElement('option');
        newOption.value = '__new__';
        newOption.textContent = '+ Êñ∞„Åó„ÅÑÊ°à‰ª∂„ÇíËøΩÂä†';
        select.appendChild(newOption);
        
        // Êñ∞Ë¶è„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÈÅ∏ÊäûÊôÇ„ÅÆÂá¶ÁêÜ
        select.addEventListener('change', function() {
            if (this.value === '__new__') {
                const newProject = prompt('Êñ∞„Åó„ÅÑÊ°à‰ª∂Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
                if (newProject) {
                    const option = document.createElement('option');
                    option.value = newProject;
                    option.textContent = newProject;
                    option.selected = true;
                    this.insertBefore(option, this.lastElementChild);
                } else {
                    this.value = '';
                }
            }
        });
    }

    function formatDateForInput(date) {
        const d = new Date(date);
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        const hours = String(d.getHours()).padStart(2, '0');
        const minutes = String(d.getMinutes()).padStart(2, '0');
        
        return `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    function createTask() {
        const taskData = getFormData();
        
        console.log('Creating task:', taskData);
        
        const record = {};
        Object.keys(taskData).forEach(function(key) {
            record[key] = { value: taskData[key] };
        });

        kintone.api('/k/v1/record', 'POST', {
            app: kintone.app.getId(),
            record: record
        }).then(function(response) {
            console.log('Task created:', response);
            closeModal();
            loadTasks();
            showNotification('„Çø„Çπ„ÇØ„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü', 'success');
        }).catch(function(error) {
            console.error('Task creation error:', error);
            showNotification('„Çø„Çπ„ÇØ„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
        });
    }

    function updateTask(recordId) {
        const taskData = getFormData();
        
        console.log('Updating task:', recordId, taskData);
        
        const record = {};
        Object.keys(taskData).forEach(function(key) {
            record[key] = { value: taskData[key] };
        });

        kintone.api('/k/v1/record', 'PUT', {
            app: kintone.app.getId(),
            id: recordId,
            record: record
        }).then(function(response) {
            console.log('Task updated:', response);
            closeModal();
            loadTasks();
            showNotification('„Çø„Çπ„ÇØ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'success');
        }).catch(function(error) {
            console.error('Task update error:', error);
            showNotification('„Çø„Çπ„ÇØ„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
        });
    }

    function getFormData() {
        return {
            [FIELDS.TASK_NAME]: document.getElementById('task-name').value,
            [FIELDS.PROJECT_NAME]: document.getElementById('project-name').value,
            [FIELDS.DESCRIPTION]: document.getElementById('task-description').value,
            [FIELDS.START_DATE]: document.getElementById('start-date').value,
            [FIELDS.END_DATE]: document.getElementById('end-date').value || null,
            [FIELDS.TASK_TYPE]: document.getElementById('task-type').value,
            [FIELDS.STATUS]: document.getElementById('status').value,
            [FIELDS.PRIORITY]: document.getElementById('priority').value
        };
    }

    function updateTaskDate(event, newDate) {
        const recordId = event.extendedProps.record_id;
        
        kintone.api('/k/v1/record', 'PUT', {
            app: kintone.app.getId(),
            id: recordId,
            record: {
                [FIELDS.START_DATE]: { value: newDate.toISOString() }
            }
        }).then(function() {
            showNotification('„Çø„Çπ„ÇØ„ÅÆÊó•‰ªò„ÇíÂ§âÊõ¥„Åó„Åæ„Åó„Åü', 'success');
        }).catch(function(error) {
            console.error('Date update error:', error);
            showNotification('Êó•‰ªò„ÅÆÂ§âÊõ¥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            loadTasks(); // „É™„É≠„Éº„Éâ„Åó„Å¶ÂÖÉ„Å´Êàª„Åô
        });
    }

    function filterTasks() {
        displayTasks();
    }

    function closeModal() {
        const modal = document.querySelector('.task-modal');
        if (modal) {
            document.body.removeChild(modal);
        }
    }

    // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÂÆöÁæ©ÔºàonclickÂ±ûÊÄßÁî®Ôºâ
    window.closeModal = closeModal;

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(function() {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 3000);
    }

})();